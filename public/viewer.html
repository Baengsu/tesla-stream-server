<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Tesla Stream</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #000;
        overflow: hidden;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* 화면 꽉 채우되 비율 유지 (검은 여백 최소) */
      #frame {
        width: 100vw;
        height: 100vh;
        object-fit: contain;   /* 여백 싫으면 cover 로 바꾸면 됨 (일부 크롭) */
        display: block;
      }

      /* 전체화면 버튼 (터치로 전체화면 진입용, 필요 없으면 지워도 됨) */
      #fullscreen-btn {
        position: fixed;
        right: 12px;
        bottom: 12px;
        padding: 8px 12px;
        font-size: 12px;
        border: none;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.5);
        color: #fff;
      }
    </style>
  </head>
  <body>
    <img id="frame" alt="stream" />
    <button id="fullscreen-btn">Full</button>

    <script>
      (function () {
        // URL 마지막 부분을 streamId 로 사용 (/view/tesla → "tesla")
        const pathParts = window.location.pathname.split("/");
        const streamId = pathParts[pathParts.length - 1] || "tesla";

        const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
        const wsUrl =
          wsProtocol +
          "://" +
          window.location.host +
          "/ws/view/" +
          encodeURIComponent(streamId);

        const img = document.getElementById("frame");
        const ws = new WebSocket(wsUrl);
        ws.binaryType = "arraybuffer";

        ws.onmessage = function (event) {
          const blob = new Blob([event.data], { type: "image/jpeg" });
          const url = URL.createObjectURL(blob);
          img.src = url;
        };

        // 전체화면 버튼 (지원 안 하면 그냥 무시)
        const fsBtn = document.getElementById("fullscreen-btn");
        fsBtn.addEventListener("click", () => {
          const el = document.documentElement;
          if (el.requestFullscreen) {
            el.requestFullscreen();
          } else if (el.webkitRequestFullscreen) {
            el.webkitRequestFullscreen();
          }
        });
      })();
    </script>
  </body>
</html>
